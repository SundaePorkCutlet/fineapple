<!-- <!doctype html> -->
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" lang="ko">
<meta charset="utf-8">
<!-- 공통 header -->
<th:block th:replace="layout/fragments/header.html :: header"></th:block>

	<!--begin::Body-->
	<body id="kt_body" class="aside-enabled">
		<!-- 공통 SideBar -->
		<th:block th:replace="layout/fragments/sidebar.html :: sidebar"></th:block>
		
									




								<form id="addGroupBoardForm">
									<input id = "inputGroupNo" type="hidden" name ="groupNo" th:value="${group.groupNo}">
									<div class="card card-flush mb-10">
										<!--begin::Header-->
										<div class="card-header justify-content-start align-items-center pt-4">
											<!--begin::Photo-->
											<div class="symbol symbol-45px me-5">
												<img th:if ="${session.user != null}" th:src ="@{../assets/profile/}+${session.user.userImg}" alt=""/>
											</div>
											<!--end::Photo-->
											<span class="text-gray-400 fw-bold fs-6" th:text = "${session.user.userName}"></span>
										</div>
										<!--end::Header-->
										<!--begin::Body-->
										<div class="card-body pt-2 pb-0">
											<div>
										        <h2><b>이미지 미리보기</b></h2>
										        <div class="input_wrap">
										            <a href="javascript:" onclick="fileUploadAction();" class="my_button">파일 업로드</a>
										            <input type="file" id="input_imgs" name = "files" multiple/>
										        </div>
										    </div>
										 
										    <div>
										        <div class="imgs_wrap">
										            <img id="img" />
										        </div>
										    </div>
										 
										    
											<!--begin::Input-->
											<input  class="form-control bg-transparent border-0 px-0" id="kt_social_feeds_post_input" name="message" data-kt-autosize="true"  th:placeholder = "|무슨일이 있는 공유해주세요! ${session.user.userName}님!|"  style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 41px;"></input>
											<!--end::Input-->
										</div>
										<!--end::Body-->
										<!--begin::Footer-->
										<div class="card-footer d-flex justify-content-end pt-0">
											<!--begin::Post action-->
											<a  class="btn btn-sm btn-primary" id="kt_social_feeds_post_btn">
												<!--begin::Indicator-->
												<span class="indicator-label">업로드</span>
												<!--end::Indicator-->
											</a>
											<!--end::Post action-->
										</div>
										<!--end::Footer-->
									</div>
									</form>

										<div th:each = " data : ${list}"> 
										<input type="hidden" th:value="${data.postNo}">
										<div>
											<div  class="card-header pt-9" >
												<!--begin::Author-->
												<div class="d-flex align-items-center">
													<!--begin::Avatar-->
													<div class="symbol symbol-50px me-5">
														<img th:if ="${session.user != null}" th:src ="@{../assets/profile/}+${session.user.userImg}" alt=""/>
													</div>
													<!--end::Avatar-->
													<!--begin::Info-->
													<div class="flex-grow-1">
														<!--begin::Name-->
														<a href="#" class="text-gray-800 text-hover-primary fs-4 fw-bolder" th:text=${data.user.userId}> 이름 </a>
														<!--end::Name-->
														<!--begin::Date-->
														<span class="text-gray-400 fw-bold d-block"th:text="${data.postDate}"></span>
														<!--end::Date-->
													</div>
													<!--end::Info-->
												</div>
												<!--end::Author-->
												<!--begin::Card toolbar-->
												<div class="card-toolbar">
													<!--begin::Menu wrapper-->
													<div class="m-0">
														<!--begin::Menu toggle-->
														<button class="btn btn-icon btn-color-gray-400 btn-active-color-primary me-n4" data-kt-menu-trigger="click" data-kt-menu-placement="bottom-end" data-kt-menu-overflow="true">
															<!--begin::Svg Icon | path: icons/duotune/general/gen023.svg-->
															<span class="svg-icon svg-icon-1">
																<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
																	<rect opacity="0.3" x="2" y="2" width="20" height="20" rx="4" fill="black"></rect>
																	<rect x="11" y="11" width="2.6" height="2.6" rx="1.3" fill="black"></rect>
																	<rect x="15" y="11" width="2.6" height="2.6" rx="1.3" fill="black"></rect>
																	<rect x="7" y="11" width="2.6" height="2.6" rx="1.3" fill="black"></rect>
																</svg>
															</span>
															<!--end::Svg Icon-->
														</button>
														<!--end::Menu toggle-->
														<!--begin::Menu 2-->
														<div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg-light-primary fw-bold w-200px" data-kt-menu="true">
															<!--begin::Menu item-->
															<div class="menu-item px-3">
																<div class="menu-content fs-6 text-dark fw-bolder px-3 py-4">상호작용</div>
															</div>
															<!--end::Menu item-->
															<!--begin::Menu separator-->
															<div class="separator mb-3 opacity-75"></div>
															<!--end::Menu separator-->
															<!--begin::Menu item-->
															<div class="menu-item px-3">
																<a href="#" class="menu-link px-3">수정하기</a>
															</div>
															<!--end::Menu item-->
															<!--begin::Menu item-->
															<div class="menu-item px-3">
																<a href="#" class="menu-link px-3">삭제하기</a>
															</div>
															<!--end::Menu item-->
															<!--end::Menu item-->
															<!--begin::Menu item-->
															<div class="menu-item px-3">
																<a href="#" class="menu-link px-3">신고하기</a>
															</div>
															<!--end::Menu item-->														
														</div>
														<!--end::Menu 2-->
													</div>
													<!--end::Menu wrapper-->
												</div>
												<!--end::Card toolbar-->
											</div>
											<!--end::Card header-->
											<!--begin::Card body-->
											<div class="card-body">
												<!--begin::Post content-->
												<div class="fs-6 fw-normal text-gray-700 mb-5" th:text = ${data.content}></div>
												<!--end::Post content-->
												<!--begin::Post media-->
<!-- 												<div th:if="${data.Img.size != 0}" class="row g-7 h-250px h-md-375px"> -->
													<!--begin::Col-->
													<div th:if = "${data.img.size()} != 0" >
														<!--begin::Row-->
														<div  class="row g-7 h-250px h-md-375px">
															<!--begin::Col-->
															<div class="col-lg-12">
																<div>
																	<div th:each = "dataa : ${data.img}">
																	<div align="center">
																		<img th:src="@{../assets/community/}+${dataa.imgName}" >
																	</div>
																	</div>
																</div>
															</div>
															<!--end::Col-->
														</div>
														<!--end::Row-->
													</div>
													<!--end::Col-->
												</div>
												<!--end::Post media-->
											</div>
											<!--end::Card body-->
											<!--begin::Card footer-->
											<div class="card-footer pt-0">
												<!--begin::Info-->
												<div class="mb-6">
													<!--begin::Separator-->
													<div class="separator separator-solid"></div>
													<!--end::Separator-->
													
													
													
													
													<!--begin::Nav-->
													<ul class="nav py-3">
														<!--begin::Item-->
														<li class="nav-item">
															<a class="nav-link btn btn-sm btn-color-gray-600 btn-active-color-primary btn-active-light-primary fw-bolder px-4 me-1 collapsible active" data-bs-toggle="collapse" href="#kt_social_feeds_comments_1">
															<i class="bi bi-chat-square fs-2 me-1"></i> Comments</a>
														</li>
														<!--end::Item-->
														<!--begin::Item-->
														<li class="nav-item">
															<a href="#" class="nav-link btn btn-sm btn-color-gray-600 btn-active-color-primary fw-bolder px-4 me-1">
															<i class="bi bi-heart fs-2 me-1"></i>Likes</a>
														</li>
														<!--end::Item-->
														<!--begin::Item-->
														<!--end::Item-->
													</ul>
													<!--end::Nav-->
													<!--begin::Separator-->
													<div class="separator separator-solid mb-1"></div>
													<!--end::Separator-->
													<!--begin::Comments-->
													<div class="collapse show" id="kt_social_feeds_comments_1" th:if = "${data.cmnt.size()} != 0">
														<!--begin::Comment-->
														<div th:each="dataa :${data.cmnt}" class="d-flex pt-6">
															<!--begin::Avatar-->
															<div class="symbol symbol-45px me-5">
																<img th:if ="${session.user != null}" th:src ="@{../assets/profile/}+${session.user.userImg}">
															</div>
															<!--end::Avatar-->
															<!--begin::Wrapper-->
															<div class="d-flex flex-column flex-row-fluid">
																<!--begin::Info-->
																<div class="d-flex align-items-center flex-wrap mb-0">
																	<!--begin::Name-->
																	<a href="#" class="text-gray-800 text-hover-primary fw-bolder me-6" th:text="${dataa.user.userId}"></a>
																	<!--end::Name-->
																	<!--begin::Date-->
																	<span class="text-gray-400 fw-bold fs-7 me-5"th:text=${dataa.cmntDate}></span>
																	<!--end::Date-->
																</div>
																<!--end::Info-->
																<!--begin::Text-->
																<span class="text-gray-800 fs-7 fw-normal pt-1" th:text = "${dataa.cmntContent}">댓글 내용</span>
																<!--end::Text-->
															</div>
															<!--end::Wrapper-->
														</div>
														<!--end::Comment-->
													</div>
													<!--end::Collapse-->
												</div>
												<!--end::Info-->
												<!--begin::Comment form-->
												<div class="d-flex align-items-center">
													<!--begin::Author-->
													<div class="symbol symbol-35px me-3">
														<img th:if ="${session.user != null}" th:src ="@{../assets/profile/}+${session.user.userImg}">
													</div>
													<!--end::Author-->
													<!--begin::Input group-->
													<div class="position-relative w-100">
														<!--begin::Input-->
														<input type="text" id = "content"  class="form-control form-control-solid border ps-5" name="search" value="" data-kt-autosize="true" placeholder="Write your comment.." style="overflow: hidden; overflow-wrap: break-word; resize: none; height: 59.9907px;"/>
														<button type="button" class="btn btn-info" th:onclick="javascript:fnAddCmnt()"> 댓글작성</button>
														<!--end::Input-->
													</div>
													<!--end::Input group-->
												</div>
												<!--end::Comment form-->
											</div>
											<!--end::Card footer-->								
										</div>
									
		<!-- 공통 하단 footer -->
		<th:block th:replace="layout/fragments/footer.html :: footer"></th:block>
<script type="text/javascript">
 
	// 이미지 정보들을 담을 배열
	var sel_files = [];
	
	
	$(document).ready(function() {
	    $("#input_imgs").on("change", handleImgFileSelect);
	}); 
	
	function fileUploadAction() {
	    console.log("fileUploadAction");
	    $("#input_imgs").trigger('click');
	}
	
	function handleImgFileSelect(e) {
	
	    // 이미지 정보들을 초기화
	    sel_files = [];
	    $(".imgs_wrap").empty();
	
	    var files = e.target.files;
	    var filesArr = Array.prototype.slice.call(files);
	
	    var index = 0;
	    filesArr.forEach(function(f) {
	        if(!f.type.match("image.*")) {
	            alert("확장자는 이미지 확장자만 가능합니다.");
	            return;
	        }
	
	        sel_files.push(f);
	
	        var reader = new FileReader();
	        reader.onload = function(e) {
	        	var html = "<a href=\"javascript:void(0);\" onclick=\"deleteImageAction("+index+")\" id=\"img_id_"+index+"\"><img src=\"" + e.target.result + "\" data-file='"+f.name+"' class='selProductFile' title='Click to remove'></a>";
	       
	
	            $(".imgs_wrap").append(html);
	            index++;
	
	        }
	        reader.readAsDataURL(f);
	        
	    });
	}
        
        $(function(){
        	 $("#kt_social_feeds_post_btn").on("click" , function() {
        		//var form = $('#addGroupBoardForm')[0]; // [0] 있고 없고 차이는?
        		//console.log(form);
        		var data = new FormData(); 
        		console.log(data);
        		var inputFile = $('input[name="files"]');
        		console.log(inputFile+"1");
        		console.log(inputFile[0] + "2");
        		console.log(inputFile[0].files + "3");   // FileList object 파일을로드하는 가장 간단한 방법은 표준 <input type="file">요소 를 사용하는 것 입니다. 
        		//JavaScript는 선택한 File객체 의 목록을 FileList 로 반환합니다.
        		//https://developer.mozilla.org/ko/docs/Web/API/File/Using_files_from_web_applications
        		
        		var files = inputFile[0].files;
        		
        		data.append('key','value');
        		data.append('content',$("#kt_social_feeds_post_input").val());
        		data.append('groupNo', $("#inputGroupNo").val())
        		for(var i = 0; i < files.length; i ++){
        			data.append('uploadFile', files[i])
        		}
        		

        		
        		

        	var content= $("#kt_social_feeds_post_input").val();
        	if(content=""){
        		alert("내용이 입력되지 않았습니다.");
        		return;
        	}
        	
        	$.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "/community/json/addGroupPost",
                data: data,
                processData: false, //false로 선언 시 formData를 string으로 변환하지 않음 기본값은 true다
                contentType: false, //contentType : false 로 선언 시 content-type 헤더가 multipart/form-data로 전송되게 함
                cache: false, //ajax 캐리 처리(?) ajax 로 통신 중 cache 가 남아서 갱신된 데이터를 받아오지 못할 경우
                timeout: 600000, //ajax 대기 시간
                //async : false //true가 default, false시 동기로 처리
                success: function (data) {
                	
                	window.location.reload();
                	
                },
                error: function (e) {
                    
                }
            });
        });
        });
        
        
        function fnAddCmnt(){
    		var data = {
    				postNo : $("#postNo").val(),
    				cmntContent : $("#content").val()
    				};
    		console.log(data)
    		$.ajax({
    			url: "/community/json/addCmnt",
    			type: "POST",
    			dataType: 'json',
    			contentType: "application/json",
    			data: JSON.stringify(data),
    			success : (function(data){
    				console.log(data)
    				//$("#postNo").attr("data-cmntList", data.list);
    				location.reload();
    				
    			})
    		})
    					
    	}; 
        
        
        	
        	

        
</script>


	</body>
	<!--end::Body-->
</html>