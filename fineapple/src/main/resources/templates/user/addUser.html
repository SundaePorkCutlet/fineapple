<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" lang="ko">
<meta charset="utf-8">
<!-- 공통 header -->
<th:block th:replace="layout/fragments/header.html :: header"></th:block>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">
<style>
	*{
	font-family: 'IBM Plex Sans KR', sans-serif;
	}
    form .mb-10 label{
        text-align: left;
        display: block;
    }
    form .input-with-btn input{
        margin-right: 10px;
    }

    form .input-with-btn button{
        white-space: nowrap;
    }
</style>

   <!--begin::Body-->
   <body id="kt_body" class="aside-enabled">
      <!-- 공통 SideBar -->
      <th:block th:replace="layout/fragments/sidebar.html :: sidebar"></th:block>
<!-- ////////////////////////////////////여기까지 절대 고정 건드리지마셈//////////////////////////////////// -->



<form method="POST" enctype="multipart/form-data" >
<div align="center">
<h1 class="fs-2tx fw-bolder mb-8">
											<span class="d-inline-block position-relative ms-2">
												<span class="d-inline-block mb-2">JOIN</span>
												<span class="d-inline-block position-absolute h-8px bottom-0 end-0 start-0 bg-success translate rounded"></span>
											</span></h1>
<div align="center" data-text-content="true" style="font-size: 13px;" class="text-muted">회원가입은 무료이며</div>
<div align="center" data-text-content="true" style="font-size: 13px;" class="text-muted">기능별 추가 기입사항은 기능 활성화시 요구됩니다.</div>
<br>
<ins>
</ins>
<br>
<div align="center" data-text-content="true" style="max-width:300px;" class="mb-10">
  <label for="exampleFormControlInput1" >정보입력(* 필수)</label>
</div>

<div class="mb-10" style="max-width:300px;" th:if="${user.userId != null }">
            <label for="userId" class="required form-label">이메일</label>
            <div class="d-flex flex-stack input-with-btn">
                <input name="userId" type="text" id ="userId" class="form-control form-control-solid" th:value = "${user.userId}" readonly/>
                <button class="btn btn-primary" type="button" data-kt-element="send" id="sendMail" name="sendMail">전송</button>
            </div>
        </div>

<div class="mb-10" style="max-width:300px;" th:if="${user.userId == null }">
            <label for="userId" class="required form-label">이메일</label>
            <div class="d-flex flex-stack input-with-btn">
                <input name="userId" type="text" id ="userId" class="form-control form-control-solid" placeholder="fine@fineapple.or.kr" required/>
                <button class="btn btn-primary" type="button" data-kt-element="send" id="sendMail" name="sendMail">전송</button>
            </div>
        </div>
                <span align="center" id = "change" name ="change"></span>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label" th:if ="${user.userId == null}">인증번호</label>
   <p> <input id="compare" name ="compare"type="text" class="form-control form-control-solid" placeholder="인증번호 전송버튼을 눌러주세용"/>
   <span align="center" id = "compareEmail" name ="compareEmail"></span></p>
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">이름(닉네임)</label>
    <input name="userName" id="userName" type="text" class="form-control form-control-solid" placeholder="ex)파인이" maxlength ="10"required/>
        <div id="changetwo" name="changetwo"></div>
    
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">휴대폰번호</label>
    <input name="cellphone" id="cellphone" type="number" oninput='handleOnInput(this, 11)' class="form-control form-control-solid" placeholder="ex)01012345678"required/>
</div>
<div class="mb-10" style="max-width:300px;" th:if="${user.userId == null}">
    <label for="exampleFormControlInput1" class="required form-label">비밀번호</label>
    <input name="password" id="password" type="password" class="form-control form-control-solid" placeholder="최소 5자,하나 이상의 문자와 숫자로 입력해주세요." oninput='handleOnInput(this, 11)' required/>
    <div id="changeone" name="changeone"></div>
    <br>
    <label for="exampleFormControlInput1" class="required form-label">비밀번호 확인</label>
    <input name="checkPassword" id="checkPassword" type="password" class="form-control form-control-solid" oninput='handleOnInput(this, 11)' placeholder="ex)비밀번호 확인"required/>
    <p> <span align="center" id = "changePassword" name ="changePassword"></span>
    
</div>
<div class="mb-10" style="max-width:300px;" th:if="${user.userId != null}">
    <input name="password" id="password" type="hidden" th:value="${user.password}" class="form-control form-control-solid"  required/>
    <input name="checkPassword" id="checkPassword" type="hidden" th:value="${user.password}" class="form-control form-control-solid" required/>
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">몸무게</label>
    <input name="weight" id="weight" type="number" class="form-control form-control-solid" placeholder="ex)60" oninput='handleOnInput(this, 3)' required/>
    <div id="changethree" name="changethree"></div>
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">성별</label>
   <span><input name="gender" id="male" type="radio" checked = "checked" value ="male"  class="form-check-input"/>남</span>
   <span><input name="gender" id="female" type="radio" value ="female" class="form-check-input"/>여</span>
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">키</label>
    <input name="height" id="height" type="number" class="form-control form-control-solid" oninput='handleOnInput(this, 3)' placeholder="ex)170" maxlength="4" required/>
    <div id="changefour" name="changefour"></div>
    
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" class="required form-label">나이</label>
    <input name="age" id="age" type="number" class="form-control form-control-solid" oninput='handleOnInput(this, 2)' placeholder="ex)20" required/>
    <div id="changefive" name="changefive"></div>
    
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1"class="required form-label" >목표체중</label>
    <input id="trgtWeight" name="trgtWeight" type="number" class="form-control form-control-solid" oninput='handleOnInput(this, 3)' placeholder="ex)57" required/>
    <div id="changesix" name="changesix"></div>
    
</div>
<div class="mb-10" style="max-width:300px;">
    <label for="exampleFormControlInput1" >프로필사진(선택)</label>
    <input id="userImg1" name="userImg1" type="file" class="form-control form-control-solid" />
</div>
 <div  data-text-content="true" style="max-width:300px;">
     <label for="exampleFormControlInput1"class="required form-label" >목표설정</label>
         <select  class="form-select form-select-solid" data-control="select 1" name="serviceTrgt" id="serviceTrgt">
         <option value ="체중감량">체중감량</option>
         <option value ="체중유지">체중유지</option>
         <option value ="체중증량">체중증량</option>         
         </select>
  </div>

<br>
          <button class="btn btn-success" id="submit" style="max-width:100px;">회원가입</button>
        

</div>
<br>
</form>

<!-- ////////////////////////////////////여기부터 다시 절대 고정 건드리지마셈//////////////////////////////////// --> 
      <!-- 공통 하단 footer -->
<th:block th:replace="layout/fragments/footer.html :: footer"></th:block>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script th:inline="javascript">

var passwordResult = true;
	function handleOnInput(el, maxlength) {
	  if(el.value.length > maxlength)  {
	    el.value 
	      = el.value.substr(0, maxlength);
	  }
	}
	$(function(){
		$("#password").on("keyup",function(){
			var password = $("#password").val();
			if(password.length >= 11 ){
				$("#changeone").html("<p>비밀번호는 11자까지 입력이 가능합니다.</p>");
				   	$("#changeone").css('color','red');
			}else{
				$("#changeone").empty();
			}
		});
		$("#userName").on("keyup",function(){
			var userName = $("#userName").val();
			if(userName.length >= 10 ){
				$("#changetwo").html("<p>닉네임(이름)은 10자까지 입력이 가능합니다.</p>");
			   	$("#changetwo").css('color','red');
			}else{
				$("#changetwo").empty();
			}
		});
/* 		$("#weight").on("keyup",function(){
			var weight = $("#weight").val();
			if(weight.length >= 4 ){
				$("#changethree").html("<p>입력된 몸무게를 다시 확인해주세요.</p>");
			    $("#changethree").css('color','red');
			}else{
				$("#changethree").empty();
			}
		});
		$("#height").on("keyup",function(){
			var height = $("#height").val();
			if(height.length >= 4 ){
				$("#changefour").html("<p>입력된 키를 다시 확인해주세요.</p>");
			    $("#changefour").css('color','red');
			}else{
				$("#changefour").empty();
			}
		});
		$("#age").on("keyup",function(){
			var age = $("#age").val();
			if(age.length >= 3 ){
				$("#changefive").html("<p>입력된 나이를 다시 확인해주세요.</p>");
			    $("#changefive").css('color','red');
			}else{
				$("#changefive").empty();
			}
		});
		$("#trgtWeight").on("keyup",function(){
			var trgtWeight = $("#trgtWeight").val();
			if(trgtWeight.length >= 4 ){
				$("#changesix").html("<p>입력된 목표체중을 다시 확인해주세요.</p>");
			    $("#changesix").css('color','red');
			}else{
				$("#changesix").empty();
			}
		});
		 */
	})

   $(function(){
      $("#agreementbt").on("click",function(){
         popWin = window.open("/user/agreement.html")
      });
   });
   
 
  
  
   $(function(){
      $("#userId").on("keyup",function(){
        // console.log("올라갔닝")
         var userId = $("#userId").val()
       //  console.log(userId);
         data = { 
               userId : userId
               }
         $.ajax(
               {
                  url:"/user/checkDuplication",
                  method:"POST",
                  data: JSON.stringify(data),
                  accept : "application/json",
                  contentType : "application/json"
         }).done(function(result){
          //  console.log(result);
            if(result == 0){
               if(userId != ""){
                  if(userId.indexOf('@') <1 || userId.indexOf('.') == -1){
                     $("#change").html("<p>올바른 email형식이 아닙니다.</p>");
                     $("#userId").css('color','red');

                  }
                  else{
                     $("#change").html("<p>사용가능한 아이디입니다.</p>");
                     $("#userId").css('color','green');
                  }
               }else{
                  $("#change").html("");
               }
               
            }else{
               $("#change").html("<p>이미 사용중인 아이디 이거나 중복된 아이디 입니다.</p>");
               $("#userId").css('color',"red");
               $("#userId").val("");
               $("#userId").focus();
               
            }
         })
      });
   });
   

  $(function(){

	      $("#sendMail").on("click",function(){
	    	  
	          var userId = $("#userId").val();
	          var data ={
	        	  userId:userId
	          };
	          if(userId == ""){
	             alert("메일주소가 입력되지 않았습니다.");
	          }else{
	        	
	         	 $.ajax({
	         		type : "POST",
	         		url : "/user/sendMail",
	         		data : JSON.stringify(data),
	         		accept : "application/json",
	         		contentType : "application/json"
	         	 }).done(function(data){
	         		 alert("해당 이메일로 인증번호가 전송되었습니다");
	         		 isCertifidation = true;
	         		 var key = data;
	         		   $("#compare").on("keyup",function(){
	         		//	   console.log("인증번호 올라갔닝")
	         			   var compare = $("#compare").val();
	         			 //  console.log(compare)
	         			   if(compare == key){
	         				   $("#compareEmail").html("<p>인증성공!</p>")
	         				   $("#compareEmail").css('color','green');
	         				   isCertification=true;
	         			   }else{
	         				   $("#compareEmail").html("<p>인증실패!</p>")
	         				   	$("#compareEmail").css('color','red');
	         				   isCertification=false;
	         			   }
	         		   })
	         	 })
	         	 
	  
	          }

         })
  })
  
	
   
  
	  $(function(){

		   
		   
		  $("#checkPassword").keyup(function(){
		  var password= $("#password").val();
		  var checkPassword = $("#checkPassword").val();
		 
		 
			//console.log(checkPassword);
			  if(password == checkPassword){
				  $("#changePassword").html("<div>비밀번호가 일치합니다.</div>");
				  $("#changePassword").attr('color', '#31B404');
				  passwordResult=true;

			  }
			  else if(password != checkPassword){
				  $("#changePassword").html("<div>비밀번호가 일치하지 않습니다.</div>");
				  $("#changePassword").attr('color', '#FF0000');
				  passwordResult=false;
			  }
		  })
			  
	  
	   
	   $("#submit").on("click",function(){
		
      var userName=$("#userName").val();
      var password=$("#password").val();
      var cellphone=$("#cellphone").val();
      var age =$("#age").val();
      var height = $("height").val();
      var weight = $("#weight").val();
      var trgtWeight=$("trgtWeight").val();
      var userId = $("#userId").val();
      var compareEmail = $("compareEmail").val();
      var textTest = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;
      var reg = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{5,}$/;
   
      if($("#male").val() == 'male'){
         var gender=$("#male").val();
      }
      if($("#female").val() == 'female'){
         var gender=$("#female").val();
      }
/*       if(userName == ""){
         alert("닉네임을 입력하지 않으셨습니다.");
         return; */
      /* }else */ if(userId == ""){
         alert("이메일을 입력하지 않으셨습니다.");
         return false;
      }else if(textTest.test(userId)==false){
         alert("이메일 형식으로 입력해주세요.")
         return false;
      }
      else if(password == ""){
         alert("비밀번호를 입력하지 않으셨습니다.");
         return false;
      }else if(compareEmail == ""){
    	alert("인증번호를 입력하지 않으셨습니다.");
        return false;
      }else if(cellphone == ""){
         alert("전화번호를 입력하지 않으셨습니다.");
         return false;
      }else if(age == ""){
         alert("나이를 입력하지 않으셨습니다.");
         return false;
      }else if(weight == ""){
         alert("몸무게를 입력하지 않으셨습니다.");
         return false;
      }else if(height == ""){
         alert("키를 입력하지 않으셨습니다.");
         return false;
      }else if(trgtWeight == ""){
         alert("목표체중을 입력하지 않으셨습니다.");
         return false;
      }else if(isCertification == false){
    	  alert("인증번호가 일치하지 않습니다.");
          return false;
      }else if(passwordResult==false){
    	  alert("비밀번호가 일치하지 않습니다.");
          return false;
      }else if(!reg.test(password)){
    	  alert("비밀번호 규칙 위반입니다.");
          return false;
      }else{
         alert("회원가입에 성공하셨습니다.");
          $("form").attr("method","POST").attr("action","/user/addUser/redirect").submit();
      }
   //    console.log(gender);
  //    console.log("fncAddUser끝");

      });

	  });
	  

      

   
</script>

   </body>
   <!--end::Body-->
</html>